<div class="mt-6 pt-4 border-t">
  <h3 class="font-medium text-gray-700 mb-2">Controles de Moderador</h3>

  <!-- Controles quando votos não revelados -->
  <div *ngIf="!votosRevelados" class="flex justify-center">
    <button
      (click)="aoRevelarVotos()"
      [class]="classesRevelarVotos"
      [disabled]="!podeRevelarVotos"
      [attr.aria-label]="podeRevelarVotos ? 'Revelar votos de todos os participantes' : textoRevelarVotos">
      <!-- 🆕 Ícone com opacidade condicional -->
      <span [innerHTML]="iconeRevelarVotos" [class.opacity-50]="!podeRevelarVotos"> </span>
      <!-- 🆕 Texto dinâmico -->
      {{ textoRevelarVotos }}
    </button>
  </div>

  <!-- Controles quando votos revelados -->
  <div *ngIf="votosRevelados" class="flex flex-wrap gap-2 justify-center">
    <button
      class="min-w-[140px] px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition-colors flex items-center justify-center whitespace-nowrap"
      (click)="aoReiniciarVotacao()"
      aria-label="Reiniciar votação atual">
      <span [innerHTML]="iconeReiniciarVotacao"></span>
      Reiniciar Votação
    </button>

    <button
      (click)="abrirModalNovaRodada()"
      [disabled]="processando"
      class="min-w-[140px] px-3 py-2 rounded-md transition-colors flex items-center justify-center whitespace-nowrap text-white"
      [ngClass]="obterClassesBotaoNovaRodada()"
      aria-label="Iniciar nova rodada">
      <span *ngIf="!processando" [innerHTML]="iconeNovaRodada"></span>
      {{ processando ? 'Processando...' : 'Nova Rodada' }}
    </button>

    <button
      (click)="aoEncerrarSala()"
      class="min-w-[140px] px-3 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-800 transition-colors flex items-center justify-center whitespace-nowrap"
      aria-label="Encerrar sala">
      <span [innerHTML]="iconeEncerrarSala"></span>
      Encerrar Sala
    </button>
  </div>

  <!-- Texto de ajuda -->
  <p *ngIf="votosRevelados" class="text-xs text-gray-500 mt-2 text-center">
    Inicie uma nova rodada para salvar os resultados no histórico e preparar uma nova votação.
  </p>
</div>

<!-- Modal para criar nova rodada -->
<app-modal
  [visivel]="modalNovaRodadaAberto"
  titulo="📝 Iniciar Nova Rodada"
  descricao="Defina a descrição da próxima rodada de votação"
  focoInicial="input[type='text']"
  (fechar)="fecharModalNovaRodada()">
  <p class="text-gray-600 mb-4">
    Descreva a próxima rodada de votação. Todos os resultados atuais serão salvos no histórico.
  </p>

  <div class="space-y-4">
    <div>
      <label for="descricao-rodada" class="block text-sm font-medium text-gray-700 mb-1">
        Descrição da rodada <span class="text-red-500">*</span>
      </label>

      <input
        id="descricao-rodada"
        type="text"
        [value]="descricaoNovaRodada"
        (input)="atualizarDescricao($event)"
        placeholder="Ex: Story 123 - Cadastro de Usuários"
        maxlength="100"
        [class]="
          'w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-poker-blue focus:border-transparent transition-colors ' +
          (validacaoMensagem ? 'border-red-300 focus:ring-red-500' : 'border-gray-300')
        "
        [attr.aria-describedby]="validacaoMensagem ? 'validacao-mensagem' : 'descricao-help'"
        [attr.aria-invalid]="!ehValido && descricaoNovaRodada.length > 0"
        aria-required="true" />

      <!-- Mensagem de validação -->
      <div
        *ngIf="validacaoMensagem"
        id="validacao-mensagem"
        class="mt-1 text-sm text-red-600"
        role="alert"
        aria-live="polite">
        {{ validacaoMensagem }}
      </div>

      <!-- Texto de ajuda -->
      <div *ngIf="!validacaoMensagem" id="descricao-help" class="mt-1 text-sm text-gray-500">
        Mínimo 3 caracteres, máximo 100. Pressione Enter para confirmar ou ESC para cancelar.
      </div>

      <!-- Contador de caracteres -->
      <div class="mt-1 text-xs text-gray-400 text-right">{{ descricaoNovaRodada.length }}/100 caracteres</div>
    </div>

    <div class="flex justify-end space-x-3 pt-2">
      <button
        type="button"
        (click)="cancelarELimparFormulario()"
        class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors"
        [disabled]="processando">
        Cancelar
      </button>

      <button
        type="button"
        (click)="confirmarNovaRodada()"
        [disabled]="!podeCriar"
        [class]="
          'px-4 py-2 rounded-md transition-colors font-medium ' +
          (podeCriar
            ? 'bg-green-600 text-white hover:bg-green-700 cursor-pointer'
            : 'bg-gray-300 text-gray-500 cursor-not-allowed')
        "
        [attr.aria-describedby]="!ehValido ? 'botao-help' : null">
        {{ processando ? 'Processando...' : 'Confirmar' }}
      </button>

      <!-- Ajuda para botão desabilitado -->
      <div *ngIf="!ehValido && descricaoNovaRodada.length > 0" id="botao-help" class="sr-only">
        Botão desabilitado. {{ validacaoMensagem }}
      </div>
    </div>
  </div>
</app-modal>
